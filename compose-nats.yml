x-nats-base: &nats-base
  

services:
  nats:
    profiles: [nats]
    image: docker.io/nats:${NATS_VERSION:-2.11-alpine}
    restart: always
    expose: 
      - 4222
      - 8222
      - 6222
    # healthcheck:
    #   test: ["CMD", "nc", "-zv", "-w", "10", "nats", "4222"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 10
    #   start_period: 30s
    command: --http_port 8222 
  
  nats-exporter:
    profiles: [nats-exporter]
    image: docker.io/bitnami/nats-exporter:${NATS_EXPORTER_VERSION:-0.17.3}
    depends_on:
      - nats
    expose:
      - 7777
    command:
      - -healthz
      - -varz
      - "http://nats:8222"
    labels:
      prometheus.io/scrape: "true"
      prometheus.io/port: 7777
