#!/bin/bash
set -euo pipefail

# Wait for MongoDB primary
for i in {1..60}; do
  if mongosh --quiet --eval 'db.isMaster().ismaster' | grep -q true; then
    break
  fi
  echo "Waiting for MongoDB primary ($i/60)"
  sleep 1
done

cd /app/bundle
exec chpst -u rocketchat:nogroup node main.js
